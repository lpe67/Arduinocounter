#include <LiquidCrystal_I2C.h>
#include <ezButton.h>
#include <HCSR04.h>
#define TRIG 7
#define ECHO 6
#define BUZZ 11
#define BOTAO 12
#define LED 2

byte customChar0[8] = {
	0b01010,
	0b00100,
	0b10001,
	0b01110,
	0b01010,
	0b01010,
	0b11111,
	0b00000
};

byte customChar1[8] = {
	0b00000,
	0b00000,
	0b00000,
	0b01110,
	0b01010,
	0b01010,
	0b11111,
	0b00000
};

LiquidCrystal_I2C lcd(0x27, 16, 2);

HCSR04 hc (7, 6);

int distancia = 0;
int modo = 0;
int bValue = 0;
int visita = 0;

ezButton button(BOTAO);

void setup() {
  button.setDebounceTime(50);
  pinMode(TRIG, OUTPUT);
  pinMode(ECHO, INPUT);
  pinMode(BUZZ, OUTPUT);
  pinMode(BOTAO, INPUT_PULLUP);
  pinMode(LED, OUTPUT);

  lcd.createChar(0, customChar0);
  lcd.createChar(1, customChar1);

  lcd.init();
  lcd.backlight();
  lcd.setCursor(0, 1);
  lcd.print("Visitas e saidas");
  
  lcd.setCursor(0, 0);
  lcd.print("V/S:");
  
}

void loop() {
int distancia = hc.dist();
  button.loop();

bValue = button.getState();

if (button.isPressed() && modo == 0) {
  modo = 1;
  lcd.clear();
  lcd.setCursor(0, 1);
  lcd.print("Modo alarme");
  lcd.setCursor(0, 0);
  lcd.print("---");
  lcd.setCursor(15, 1);
  lcd.write((byte)1);
  }
else if (button.isPressed() && modo == 1) {
  modo = 0;
  lcd.clear();
  lcd.setCursor(0, 1);
  lcd.print("Visitas e saidas");
  lcd.setCursor(0, 0);
  lcd.print("V/S:");
  }

if (modo == 0) {
  lcd.setCursor(4, 0);
  lcd.print (visita);
}

if (distancia < 70 && modo == 0) {
  visita++;
  delay(1500);
}
else if (distancia < 50 && modo == 1) {
  tone(BUZZ, 12000);
  lcd.setCursor(0, 1);
  lcd.print("Alarme ativo");
  lcd.setCursor(0, 0);
  lcd.print("!!!");
    digitalWrite(LED, HIGH);
    lcd.setCursor(15, 1);
  lcd.write((byte)0);
    delay(1000000000000000);
    
}
  lcd.setCursor(10, 0);
  lcd.print(" ");
  lcd.setCursor(11, 0);
  lcd.print(hc.dist());


}
